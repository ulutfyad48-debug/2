<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Ù†Ø§ÙˆÙ„Ø³ØªØ§Ù† - Ù¾Ø±ÛŒÙ…ÛŒÙ… Ù¾ÙˆØ±Ù¹Ù„</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --bg: #0a0e27; --card: #1a1f3a; --accent: #ff0a54; 
            --accent2: #00d9ff; --text: #ffffff; --success: #2ed573;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Nastaliq Urdu', serif; background: var(--bg); color: var(--text); line-height: 1.6; }
        .container { max-width: 500px; margin: 0 auto; padding: 15px; }
        
        /* Header */
        .header { text-align: center; border-bottom: 3px solid var(--accent); border-radius: 0 0 30px 30px; margin-bottom: 25px; background: var(--card); overflow: hidden; }
        .header-cover { width: 100%; height: 200px; object-fit: cover; }
        .header h1 { font-size: 2.5rem; padding: 15px; }

        /* Grid */
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .nav-btn { background: var(--card); border-radius: 18px; border: 1px solid rgba(255,255,255,0.1); cursor: pointer; text-align: center; overflow: hidden; }
        .nav-btn img { width: 100%; height: 110px; object-fit: cover; }
        .nav-btn h3 { padding: 10px; font-size: 1rem; }

        /* Game UI */
        .puzzle-section { background: var(--card); padding: 20px; border-radius: 20px; text-align: center; border: 2px solid var(--accent2); }
        .timer-circle { width: 90px; height: 90px; border-radius: 50%; border: 4px solid var(--accent); line-height: 82px; font-size: 32px; margin: 0 auto 15px; color: var(--accent); font-weight: bold; }
        .timer-circle.warning { color: yellow; border-color: yellow; }
        .q-text { font-size: 1.1rem; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin-bottom: 20px; border-right: 4px solid var(--accent2); }
        .btn { border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-family: inherit; font-weight: bold; width: 100%; margin-top: 10px; }
        .btn-wa { background: #16a34a; color: white; text-decoration: none; display: inline-block; width: 48%; }
        .btn-opt { background: #2d2d3a; color: white; border: 1px solid #444; margin: 5px 0; }
        
        /* Success Screen */
        #success-section { display: none; background: #000; padding: 30px; border-radius: 20px; border: 2px solid var(--success); }
        .track-box { background: var(--success); color: #000; padding: 15px; font-size: 1.5rem; font-weight: bold; border-radius: 10px; margin: 15px 0; }

        /* Modals */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); justify-content: center; align-items: center; z-index: 1000; padding: 20px; }
        .modal.active { display: flex; }
        .modal-box { background: #1a1f3a; padding: 25px; border-radius: 20px; width: 100%; max-width: 350px; text-align: center; border: 2px solid var(--accent); }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #000; color: #fff; border: 1px solid var(--accent2); border-radius: 8px; text-align: center; }

        .loading-spinner { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="home-screen" class="container">
        <header class="header">
            <img src="https://drive.google.com/thumbnail?id=18SlPABsEdm_mndblVL9xHUwCARh6ye7x&sz=w800" class="header-cover">
            <h1>Ù†Ø§ÙˆÙ„Ø³ØªØ§Ù†</h1>
        </header>

        <div class="menu-grid">
            <div class="nav-btn" onclick="location.reload()"><h3>ğŸ“– Ù†Ø§ÙˆÙ„</h3></div>
            <div class="nav-btn" onclick="openGame()">
                <img src="https://drive.google.com/thumbnail?id=11c5Imzwd7sOJ_yEL6gvgDQy85WW0Mvsi&sz=w400">
                <h3>ğŸ® Ù¾Ø²Ù„ Ú¯ÛŒÙ…</h3>
            </div>
        </div>
    </div>

    <div id="puzzle-screen" class="container" style="display:none;">
        <button class="btn" style="background:var(--accent)" onclick="location.reload()">ğŸ  ÛÙˆÙ… Ù¾ÛŒØ¬</button>
        
        <div id="auth-section" class="puzzle-section" style="margin-top:20px;">
            <h2>ğŸ® Ù¾Ø²Ù„ Ú†ÛŒÙ„Ù†Ø¬</h2>
            <p>ÙÛŒØ³: 50 Ø±ÙˆÙ¾Û’ | Ø§ÛŒØ²ÛŒ Ù¾ÛŒØ³Û: 03359079528</p>
            <div style="margin: 15px 0;">
                <a href="https://wa.me/923159226260" class="btn btn-wa">ÙˆØ§Ù¹Ø³ Ø§ÛŒÙ¾ 1</a>
                <a href="https://wa.me/923125540048" class="btn btn-wa">ÙˆØ§Ù¹Ø³ Ø§ÛŒÙ¾ 2</a>
            </div>
            <input type="text" id="accessCode" placeholder="Ø§Ù¾Ù†Ø§ Ú¯ÛŒÙ… Ú©ÙˆÚˆ ÛŒÛØ§Úº Ù„Ú©Ú¾ÛŒÚº">
            <button class="btn" style="background:var(--accent2); color:black;" onclick="verifyCode()">ğŸ¯ Ú¯ÛŒÙ… Ø´Ø±ÙˆØ¹ Ú©Ø±ÛŒÚº</button>
        </div>

        <div id="game-section" class="puzzle-section" style="display:none; margin-top:20px;">
            <div id="q-number" style="margin-bottom:10px; color:var(--accent2)">Ø³ÙˆØ§Ù„ 1 / 5</div>
            <div class="timer-circle" id="timer">60</div>
            <div id="q-content" class="q-text">Ù„ÙˆÚˆÙ†Ú¯...</div>
            <div id="options-box"></div>
        </div>

        <div id="success-section" class="puzzle-section" style="margin-top:20px;">
            <h2 style="color:var(--success)">âœ¨ Ù…Ø¨Ø§Ø±Ú© ÛÙˆ! âœ¨</h2>
            <p>Ø¢Ù¾ Ù†Û’ ØªÙ…Ø§Ù… Ø³ÙˆØ§Ù„Ø§Øª Ú©Û’ ØµØ­ÛŒØ­ Ø¬ÙˆØ§Ø¨ Ø¯Û’ Ø¯ÛŒØ¦Û’ ÛÛŒÚºÛ”</p>
            <p style="margin-top:10px;">Ø¢Ù¾ Ú©ÛŒ Ù¹Ø±ÛŒÚ©Ù†Ú¯ Ø¢Ø¦ÛŒ ÚˆÛŒ ÛŒÛ ÛÛ’:</p>
            <div class="track-box" id="tracking-id">---</div>
            <p style="font-size:0.8rem;">Ø§Ø³ Ú©Ø§ Ø§Ø³Ú©Ø±ÛŒÙ† Ø´Ø§Ù¹ Ù„ÛŒÚº Ø§ÙˆØ± Ø§Ù†Ø¹Ø§Ù… Ú©Û’ Ù„ÛŒÛ’ ÙˆØ§Ù¹Ø³ Ø§ÛŒÙ¾ Ú©Ø±ÛŒÚºÛ”</p>
            <button class="btn" style="background:var(--accent2); color:black;" onclick="location.reload()">Ø®ØªÙ… Ú©Ø±ÛŒÚº</button>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwk4hNSimgU__x1PHwrjJZe_596-2Ay-y6uTHamx7zYlSZP1MGg_dQXNtw73_f2VIKh/exec";
        const START_HOUR = 11; // 11 AM
        const END_HOUR = 23;   // 11 PM

        let puzzles = [];
        let currentIndex = 0;
        let clock = null;
        let secondsLeft = 60;
        let userFullName = "";
        let usedCode = "";

        // Ú¯ÛŒÙ… Ø³ÛŒÚ©Ø´Ù† Ú©Ú¾ÙˆÙ„Ù†Ø§ Ø§ÙˆØ± Ù¹Ø§Ø¦Ù… Ú†ÛŒÚ© Ú©Ø±Ù†Ø§
        function openGame() {
            const now = new Date();
            const hour = now.getHours();
            if (hour >= START_HOUR && hour < END_HOUR) {
                document.getElementById('home-screen').style.display = 'none';
                document.getElementById('puzzle-screen').style.display = 'block';
            } else {
                alert("Ú¯ÛŒÙ… Ú©Ø§ ÙˆÙ‚Øª ØµØ¨Ø­ 11 Ø³Û’ Ø±Ø§Øª 11 Ø¨Ø¬Û’ ØªÚ© ÛÛ’Û”");
            }
        }

        [span_0](start_span)// Ú©ÙˆÚˆ Ú©ÛŒ ØªØµØ¯ÛŒÙ‚[span_0](end_span)
        async function verifyCode() {
            const code = document.getElementById('accessCode').value.trim();
            if (!code) return alert("Ø¨Ø±Ø§Û Ú©Ø±Ù… Ú©ÙˆÚˆ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº!");

            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = 'ØªØµØ¯ÛŒÙ‚ ÛÙˆ Ø±ÛÛŒ ÛÛ’...';

            try {
                const res = await fetch(`${SCRIPT_URL}?action=verifyCode&code=${encodeURIComponent(code)}`);
                const result = await res.text();

                if (result === "SUCCESS") {
                    usedCode = code;
                    userFullName = prompt("Ø§Ù¾Ù†Ø§ Ù…Ú©Ù…Ù„ Ù†Ø§Ù… Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº:");
                    if (!userFullName) { location.reload(); return; }
                    
                    document.getElementById('auth-section').style.display = 'none';
                    document.getElementById('game-section').style.display = 'block';
                    loadPuzzles();
                } else {
                    alert("Ú©ÙˆÚˆ ØºÙ„Ø· ÛÛ’ ÛŒØ§ Ø§Ø³ØªØ¹Ù…Ø§Ù„ ÛÙˆ Ú†Ú©Ø§ ÛÛ’!");
                    btn.disabled = false;
                    btn.innerHTML = 'ğŸ¯ Ú¯ÛŒÙ… Ø´Ø±ÙˆØ¹ Ú©Ø±ÛŒÚº';
                }
            } catch (e) { alert("Ù†ÛŒÙ¹ ÙˆØ±Ú© Ø§ÛŒØ±Ø±!"); btn.disabled = false; }
        }

        [span_1](start_span)// Ø³ÙˆØ§Ù„Ø§Øª Ø³Ø±ÙˆØ± Ø³Û’ Ù„ÛŒÙ†Ø§[span_1](end_span)
        async function loadPuzzles() {
            try {
                const res = await fetch(`${SCRIPT_URL}?action=getPuzzles`);
                puzzles = await res.json();
                displayQuestion();
            } catch (e) { alert("Ø³ÙˆØ§Ù„Ø§Øª Ù„ÙˆÚˆ Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©Û’!"); }
        }

        [span_2](start_span)// Ø³ÙˆØ§Ù„ Ø¯Ú©Ú¾Ø§Ù†Ø§[span_2](end_span)
        function displayQuestion() {
            if (currentIndex >= 5) return finishGame();
            if (clock) clearInterval(clock);

            secondsLeft = 60;
            const timerEl = document.getElementById('timer');
            timerEl.innerText = secondsLeft;
            timerEl.classList.remove('warning');

            const puzzle = puzzles[currentIndex];
            document.getElementById('q-number').innerText = `Ø³ÙˆØ§Ù„ ${currentIndex + 1} / 5`;
            document.getElementById('q-content').innerText = puzzle.q;

            let html = "";
            puzzle.opts.forEach(opt => {
                const safeOpt = opt.replace(/'/g, "\\'");
                html += `<button class="btn btn-opt" onclick="checkAnswer('${safeOpt}')">${opt}</button>`;
            });
            document.getElementById('options-box').innerHTML = html;

            clock = setInterval(() => {
                secondsLeft--;
                timerEl.innerText = secondsLeft;
                if (secondsLeft <= 10) timerEl.classList.add('warning');
                if (secondsLeft <= 0) {
                    clearInterval(clock);
                    alert("ÙˆÙ‚Øª Ø®ØªÙ…!");
                    location.reload();
                }
            }, 1000);
        }

        [span_3](start_span)// Ø¬ÙˆØ§Ø¨ Ú†ÛŒÚ© Ú©Ø±Ù†Ø§[span_3](end_span)
        function checkAnswer(selected) {
            const correct = puzzles[currentIndex].ans;
            if (selected === correct) {
                currentIndex++;
                displayQuestion();
            } else {
                alert("âŒ ØºÙ„Ø· Ø¬ÙˆØ§Ø¨! Ú¯ÛŒÙ… Ø®ØªÙ…Û”");
                location.reload();
            }
        }

        [span_4](start_span)// Ú¯ÛŒÙ… Ù…Ú©Ù…Ù„ Ø§ÙˆØ± Ù¹Ø±ÛŒÚ©Ù†Ú¯ Ø¢Ø¦ÛŒ ÚˆÛŒ Ù„ÛŒÙ†Ø§[span_4](end_span)
        async function finishGame() {
            clearInterval(clock);
            document.getElementById('game-section').innerHTML = "<h3>ÚˆÛŒÙ¹Ø§ Ù…Ø­ÙÙˆØ¸ ÛÙˆ Ø±ÛØ§ ÛÛ’...</h3>";
            
            try {
                const res = await fetch(`${SCRIPT_URL}?action=saveWinner&name=${encodeURIComponent(userFullName)}&code=${encodeURIComponent(usedCode)}`);
                const trackingId = await res.text();
                
                document.getElementById('game-section').style.display = 'none';
                document.getElementById('tracking-id').innerText = trackingId;
                document.getElementById('success-section').style.display = 'block';
            } catch (e) { 
                alert("ÚˆÛŒÙ¹Ø§ Ø³ÛŒÙˆ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û ÛÙˆØ§ØŒ Ø§Ø³Ú©Ø±ÛŒÙ† Ø´Ø§Ù¹ Ù„ÛŒÚºÛ”"); 
            }
        }
    </script>
</body>
</html>
