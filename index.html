<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="description" content="Ù†Ø§ÙˆÙ„Ø³ØªØ§Ù†: Ø§Ø±Ø¯Ùˆ Ù†Ø§ÙˆÙ„Ø²ØŒ Ø¨ÛØªØ±ÛŒÙ† Ø´Ø§Ø¹Ø±ÛŒ Ø§ÙˆØ± Ù¾Ø±ÛŒÙ…ÛŒÙ… Ø§Ø¯Ø¨ÛŒ Ù…ÙˆØ§Ø¯ Ú©Ø§ Ù…Ø³ØªÙ†Ø¯ Ù…Ø±Ú©Ø²Û”">
    <title>Ù†Ø§ÙˆÙ„Ø³ØªØ§Ù† - Ù¾Ø±ÛŒÙ…ÛŒÙ… Ù¾ÙˆØ±Ù¹Ù„</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@400;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    
    <style>
        :root { 
            --bg: #0a0e27; 
            --card: #1a1f3a; 
            --accent: #ff0a54; 
            --accent2: #00d9ff; 
            --text: #ffffff;
            --success: #2ed573;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Noto Nastaliq Urdu', serif; 
            background: var(--bg); 
            color: var(--text);
            min-height: 100vh; 
            line-height: 1.6;
        }
        .container { max-width: 500px; margin: 0 auto; padding: 15px; }
        
        /* Header */
        .header { 
            text-align: center; 
            border-bottom: 3px solid var(--accent); 
            border-radius: 0 0 30px 30px; 
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(255,10,84,0.2);
            overflow: hidden; 
            position: relative;
            background: var(--card);
        }
        .header-cover { width: 100%; height: 220px; object-fit: cover; display: block; }
        .header-content { 
            padding: 25px 10px; 
            background: linear-gradient(to bottom, transparent, rgba(10,14,39,0.9)); 
            margin-top: -70px; 
            position: relative; 
        }
        .header h1 { 
            font-size: 3rem; 
            text-shadow: 0 0 15px rgba(255,10,84,0.6); 
            cursor: pointer; 
        }

        /* Menu Grid */
        .menu-grid { display: grid; gap: 15px; grid-template-columns: 1fr 1fr; }
        .nav-btn { 
            background: var(--card); 
            border-radius: 18px; 
            overflow: hidden; 
            border: 1px solid rgba(255,255,255,0.1); 
            transition: 0.2s;
            cursor: pointer;
        }
        .nav-btn:active { transform: scale(0.96); }
        .nav-btn img { width: 100%; height: 160px; object-fit: cover; }
        .nav-btn h3 { padding: 15px; text-align: center; font-size: 1.3rem; }

        /* Items Grid */
        .items-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card { 
            background: #1a1f3a; 
            padding: 15px 10px; 
            border-radius: 12px; 
            text-align: center; 
            border: 1px solid #3a3f5a; 
            cursor: pointer; 
        }
        .card.locked { opacity: 0.7; border-style: dashed; border-color: var(--accent); }

        /* Modals */
        .modal { 
            display: none; 
            position: fixed; 
            inset: 0; 
            background: rgba(0,0,0,0.9); 
            justify-content: center; 
            align-items: center; 
            z-index: 1000; 
            padding: 20px; 
        }
        .modal.active { display: flex; }
        .modal-box { 
            background: #1a1f3a; 
            padding: 25px; 
            border-radius: 20px; 
            width: 100%; 
            max-width: 380px; 
            text-align: center; 
            border: 2px solid var(--accent); 
        }
        
        /* Buttons */
        .wa-container { display: flex; gap: 8px; margin: 15px 0; }
        .btn-wa { 
            background: #16a34a; 
            color: #fff; 
            text-decoration: none; 
            padding: 12px; 
            border-radius: 10px; 
            flex: 1; 
            font-size: 0.9rem; 
            font-weight: bold; 
        }
        .btn-back { 
            background: var(--accent); 
            color: #fff; 
            border: none; 
            padding: 12px; 
            width: 100%; 
            border-radius: 10px; 
            margin-bottom: 15px; 
            cursor: pointer; 
            font-weight: bold; 
        }
        
        input { 
            width: 100%; 
            padding: 12px; 
            margin: 10px 0; 
            background: #000; 
            color: #fff; 
            border: 1px solid var(--accent2); 
            border-radius: 8px; 
            text-align: center; 
            font-size: 1.2rem; 
        }
        .btn-verify { 
            background: var(--accent2); 
            border: none; 
            width: 100%; 
            padding: 12px; 
            border-radius: 8px; 
            font-weight: bold; 
            cursor: pointer; 
            color: #000; 
        }
        .close-btn { 
            margin-top: 15px; 
            cursor: pointer; 
            display: inline-block; 
            color: var(--accent); 
            font-weight: bold; 
        }
        
        .novel-list-card { 
            background: var(--card); 
            padding: 25px; 
            border-radius: 15px; 
            border: 1px solid #3a3f5a; 
            margin-bottom: 15px; 
            text-align: center;
            cursor: pointer;
        }

        /* Puzzle Game Styles */
        .puzzle-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .puzzle-info-box {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        .timer-circle {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            border: 5px solid var(--accent);
            line-height: 90px;
            font-size: 32px;
            font-weight: bold;
            margin: 0 auto 20px;
            color: var(--accent);
            box-shadow: 0 0 20px rgba(255, 71, 87, 0.4);
        }
        .timer-circle.warning { border-color: #ff9800; color: #ff9800; }
        .q-text {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 25px;
            line-height: 1.6;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border-right: 4px solid var(--accent);
        }
        .btn-opt {
            background: #2d2d3a;
            color: white;
            border: 2px solid #444;
            width: 100%;
            padding: 15px;
            margin: 8px 0;
            border-radius: 12px;
            font-size: 16px;
            cursor: pointer;
            transition: 0.3s;
        }
        .btn-opt:hover { background: var(--accent); border-color: var(--accent); }
        .tracking-display {
            background: #333;
            padding: 20px;
            border-radius: 12px;
            letter-spacing: 3px;
            color: var(--success);
            font-size: 28px;
            font-weight: bold;
            margin: 20px 0;
            border: 2px dashed var(--success);
            word-break: break-all;
        }
        
        footer { text-align: center; padding: 20px; opacity: 0.6; font-size: 0.8rem; }
    </style>
</head>
<body>
    <!-- HOME SCREEN -->
    <div id="home-screen" class="container">
        <header class="header">
            <img src="https://drive.google.com/thumbnail?id=18SlPABsEdm_mndblVL9xHUwCARh6ye7x&sz=w800" alt="Cover" class="header-cover" loading="eager">
            <div class="header-content">
                <h1 onclick="location.reload()">Ù†Ø§ÙˆÙ„Ø³ØªØ§Ù†</h1>
                <p>âœ¨ Ù¾Ø±ÛŒÙ…ÛŒÙ… Ø§Ø±Ø¯Ùˆ Ù¾ÙˆØ±Ù¹Ù„ âœ¨</p>
            </div>
        </header>
        <div class="menu-grid">
            <div class="nav-btn" onclick="openSection('novel')">
                <img src="https://drive.google.com/thumbnail?id=1A6cQPJd5qacANztlmKyU6a5xiKgNAUuz&sz=w400" alt="Novel" loading="lazy">
                <h3>ğŸ“– Ù†Ø§ÙˆÙ„ Ù¾Ú‘Ú¾ÛŒÚº</h3>
            </div>
            <div class="nav-btn" onclick="openSection('poetry')">
                <img src="https://drive.google.com/thumbnail?id=1jeO58Sf8-w5fx5SPQZG8LqJjm7QfPHTe&sz=w400" alt="Poetry" loading="lazy">
                <h3>ğŸ“œ Ø§Ø±Ø¯Ùˆ Ø´Ø§Ø¹Ø±ÛŒ</h3>
            </div>
            <div class="nav-btn" onclick="openSection('puzzle')">
                <img src="https://drive.google.com/thumbnail?id=1bAfC0S2euvxZQKuawj_nVQGOiK9S41N7&sz=w400" alt="Puzzle Game" loading="lazy">
                <h3>ğŸ® Ù¾Ø²Ù„ Ú¯ÛŒÙ…</h3>
            </div>
            <div class="nav-btn" onclick="openSection('about')">
                <img src="https://drive.google.com/thumbnail?id=1bAfC0S2euvxZQKuawj_nVQGOiK9S41N7&sz=w400" alt="Author" loading="lazy">
                <h3>ğŸ‘¤ Ù…ØµÙ†Ù</h3>
            </div>
        </div>
    </div>

    <!-- NOVEL LIST SCREEN -->
    <div id="novel-list-screen" class="container" style="display:none;">
        <button class="btn-back" onclick="location.reload()">ğŸ  ÛÙˆÙ… Ù¾ÛŒØ¬</button>
        <div id="novels-container"></div>
    </div>

    <!-- CONTENT SCREEN (Poetry, About, Episodes) -->
    <div id="content-screen" class="container" style="display:none;">
        <button class="btn-back" onclick="goBack()">â¬…ï¸ ÙˆØ§Ù¾Ø³</button>
        <h2 id="section-title" style="text-align:center; margin-bottom:20px; color:var(--accent);"></h2>
        <div id="items-list" class="items-grid"></div>
    </div>

    <!-- PUZZLE GAME SCREEN -->
    <div id="puzzle-screen" class="container" style="display:none;">
        <button class="btn-back" onclick="location.reload()">ğŸ  ÛÙˆÙ… Ù¾ÛŒØ¬</button>
        
        <!-- Puzzle Info -->
        <div id="puzzle-info" class="puzzle-section">
            <h2 style="font-size: 2rem; margin-bottom: 15px;">ğŸ® Ù¾Ø²Ù„ Ú¯ÛŒÙ… Ú†ÛŒÙ„Ù†Ø¬</h2>
            <div class="puzzle-info-box">
                <p style="font-size: 1.2rem; margin: 10px 0;">ğŸ’° ÙÛŒØ³: <strong>50 Ø±ÙˆÙ¾Û’</strong></p>
                <p style="font-size: 1.2rem; margin: 10px 0;">ğŸ† Ø§Ù†Ø¹Ø§Ù…: <strong>1000 Ø±ÙˆÙ¾Û’</strong></p>
                <p style="font-size: 1rem; margin: 10px 0; color: #ffd700;">â±ï¸ 5 Ø³ÙˆØ§Ù„Ø§Øª - ÛØ± Ø³ÙˆØ§Ù„ 60 Ø³ÛŒÚ©Ù†Úˆ</p>
                <p style="font-size: 1rem; margin: 10px 0; color: #ff6b6b;">âŒ ØºÙ„Ø· Ø¬ÙˆØ§Ø¨ = Ú¯ÛŒÙ… Ø®ØªÙ…</p>
            </div>
            
            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 20px 0;">
                <p style="font-size: 0.9rem; margin-bottom: 10px;">ğŸ’¡ Ú©ÛŒØ³Û’ Ú©Ú¾ÛŒÙ„ÛŒÚºØŸ</p>
                <p style="font-size: 0.85rem; line-height: 1.6;">
                    1ï¸âƒ£ ÙˆØ§Ù¹Ø³ Ø§ÛŒÙ¾ Ù¾Ø± Ø±Ø§Ø¨Ø·Û Ú©Ø±ÛŒÚº<br>
                    2ï¸âƒ£ 50 Ø±ÙˆÙ¾Û’ Easypaisa Ú©Ø±ÛŒÚº<br>
                    3ï¸âƒ£ Code Ø­Ø§ØµÙ„ Ú©Ø±ÛŒÚº<br>
                    4ï¸âƒ£ Ú¯ÛŒÙ… Ú©Ú¾ÛŒÙ„ÛŒÚº Ø§ÙˆØ± Ø¬ÛŒØªÛŒÚº!
                </p>
            </div>
            
            <button onclick="contactForPuzzle()" style="background: #16a34a; color: white; border: none; padding: 15px 30px; border-radius: 12px; font-size: 1.2rem; font-weight: bold; cursor: pointer; width: 100%; margin: 10px 0;">
                ğŸ“± ÙˆØ§Ù¹Ø³ Ø§ÛŒÙ¾ Ù¾Ø± Ø±Ø§Ø¨Ø·Û Ú©Ø±ÛŒÚº
            </button>
            
            <button onclick="showPuzzleCodeInput()" style="background: var(--accent2); color: #000; border: none; padding: 15px 30px; border-radius: 12px; font-size: 1.2rem; font-weight: bold; cursor: pointer; width: 100%; margin: 10px 0;">
                ğŸ”‘ Ù…ÛŒØ±Û’ Ù¾Ø§Ø³ Ú©ÙˆÚˆ ÛÛ’
            </button>
            
            <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; margin-top: 20px;">
                <p style="font-size: 0.9rem; color: #ffd700;">ğŸ“² Easypaisa Ù†Ù…Ø¨Ø±:</p>
                <p style="font-size: 1.3rem; font-weight: bold; letter-spacing: 2px;">03359079528</p>
            </div>
        </div>

        <!-- Game Play Area -->
        <div id="puzzle-game" style="display:none;">
            <div class="timer-circle" id="timer">60</div>
            <div style="color: #00d2ff; font-size: 16px; margin-bottom: 15px; font-weight: bold;" id="q-number">Ø³ÙˆØ§Ù„ 1 / 5</div>
            <div class="q-text" id="q-content">Ù„ÙˆÚˆÙ†Ú¯...</div>
            <div id="options-box"></div>
        </div>

        <!-- Success Screen -->
        <div id="puzzle-success" style="display:none;">
            <div style="background: linear-gradient(135deg, var(--success) 0%, #26de81 100%); color: #000; padding: 25px; border-radius: 15px; font-weight: bold; margin-bottom: 25px;">
                <h2>ğŸ‰ Ù…Ø¨Ø§Ø±Ú© ÛÙˆ!</h2>
                <p style="font-size: 18px; margin-top: 10px;">Ø¢Ù¾ Ù†Û’ ØªÙ…Ø§Ù… Ù¾Ø²Ù„ Ø­Ù„ Ú©Ø± Ù„ÛŒÛ’ ÛÛŒÚº</p>
            </div>
            <p style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">Ø¢Ù¾ Ú©ÛŒ Ù¹Ø±ÛŒÚ©Ù†Ú¯ Ø¢Ø¦ÛŒ ÚˆÛŒ:</p>
            <div class="tracking-display" id="tracking-id">LOADING...</div>
            <p style="font-size: 14px; color: #aaa; line-height: 1.6; margin: 15px 0;">
                ğŸ“¸ Ø§Ø³ Ø¢Ø¦ÛŒ ÚˆÛŒ Ú©Ø§ Ø§Ø³Ú©Ø±ÛŒÙ† Ø´Ø§Ù¹ Ù„ÛŒÚº<br>
                ğŸ“² Easypaisa: <strong>03359079528</strong><br>
                ğŸ“± ÙˆØ§Ù¹Ø³ Ø§ÛŒÙ¾ Ù¾Ø± Ø¨Ú¾ÛŒØ¬ÛŒÚº: <strong>03159226260</strong>
            </p>
        </div>
    </div>

    <!-- PAYMENT MODAL -->
    <div id="pay-modal" class="modal">
        <div class="modal-box">
            <h2>ğŸ”’ Ù„Ø§Ú©</h2>
            <p id="pay-info" style="margin:15px 0; white-space: pre-line;"></p>
            <div class="wa-container">
                <a id="wa-link-1" href="#" class="btn-wa" target="_blank">ÙˆØ§Ù¹Ø³ Ø§ÛŒÙ¾ 1</a>
                <a id="wa-link-2" href="#" class="btn-wa" target="_blank">ÙˆØ§Ù¹Ø³ Ø§ÛŒÙ¾ 2</a>
            </div>
            <button onclick="showCodeInput()" style="background:none; border:1px solid var(--accent2); color:var(--accent2); padding:10px; width:100%; border-radius:8px; cursor:pointer;">ğŸ”‘ Ù…ÛŒØ±Û’ Ù¾Ø§Ø³ Ú©ÙˆÚˆ ÛÛ’</button>
            <p onclick="closeModals()" class="close-btn">âŒ Ø¨Ù†Ø¯ Ú©Ø±ÛŒÚº</p>
        </div>
    </div>

    <!-- CODE INPUT MODAL -->
    <div id="code-modal" class="modal">
        <div class="modal-box">
            <h2>ğŸ”‘ Ú©ÙˆÚˆ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº</h2>
            <input type="text" id="user-code" placeholder="XXXXXX">
            <button class="btn-verify" onclick="checkAccess()">âœ… ØªØµØ¯ÛŒÙ‚ Ú©Ø±ÛŒÚº</button>
            <p onclick="closeModals()" class="close-btn">âŒ Ú©ÛŒÙ†Ø³Ù„</p>
        </div>
    </div>

    <footer>&copy; 2026 Novelistan - Premium Urdu Portal</footer>

    <script>
        const FOLDERS = {
            novelMain: '1PWDGvI9Pxkzma58-BDPZYAxq4Mhw1gdu',
            poetry: '1Bje7U53wmDHhuUrAvj-NaHDAXAfMiG_h',
            about: '1QHIFfbqFIcpzHKEwEzPlRovHrC4t7wkX'
        };

        const NOVELS = { 'Ø¨Ø§Ø²Ú¯Ø´Øª Ø¹Ø´Ù‚': '1AnTGqNqtKQxRHKRXZaGxVy4H7EtlfQjI' };
        const API_KEY = 'AIzaSyCMppjIJi2_xBi3oLVXN0XjdANMX10xmwE';
        const WA_NUMBERS = ['923159226260', '923359079528'];
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwk4hNSimgU__x1PHwrjJZe_596-2Ay-y6uTHamx7zYlSZP1MGg_dQXNtw73_f2VIKh/exec";

        let unlocked = JSON.parse(localStorage.getItem('nov_unlocked')) || [];
        let currentPkg = "", currentNovel = "", currentScreen = "home";
        const cache = {};
        
        // Puzzle Game Variables
        let puzzles = [];
        let currentIndex = 0;
        let clock = null;
        let secondsLeft = 60;
        let userFullName = "";
        let usedCode = "";

        function getDailyCode(pkgId) {
            const d = new Date();
            return (pkgId + d.getDate() + (d.getMonth() + 1) + "X").toUpperCase();
        }

        function openSection(mode) {
            document.getElementById('home-screen').style.display = 'none';
            if (mode === 'novel') {
                showNovelList();
            } else if (mode === 'puzzle') {
                showPuzzleSection();
            } else {
                currentScreen = mode;
                document.getElementById('content-screen').style.display = 'block';
                const titles = { poetry: "ğŸ“œ Ø§Ø±Ø¯Ùˆ Ø´Ø§Ø¹Ø±ÛŒ", about: "ğŸ‘¤ Ù…ØµÙ†Ù" };
                document.getElementById('section-title').innerText = titles[mode] || "";
                loadFiles(FOLDERS[mode]);
            }
        }

        function showPuzzleSection() {
            const now = new Date();
            const hour = now.getHours();
            const isGameTime = (hour >= 20 && hour < 22);
            
            if (!isGameTime) {
                alert(`â° Ú¯ÛŒÙ… Ú©Ø§ ÙˆÙ‚Øª:\nØ´Ø§Ù… 8 Ø¨Ø¬Û’ Ø³Û’ Ø±Ø§Øª 10 Ø¨Ø¬Û’ ØªÚ©\n\nØ§Ø¨Ú¾ÛŒ ÙˆÙ‚Øª: ${now.toLocaleTimeString('ur-PK', {hour: '2-digit', minute: '2-digit'})}`);
                return;
            }
            
            currentScreen = "puzzle";
            document.getElementById('puzzle-screen').style.display = 'block';
            document.getElementById('puzzle-info').style.display = 'block';
            document.getElementById('puzzle-game').style.display = 'none';
            document.getElementById('puzzle-success').style.display = 'none';
        }

        function contactForPuzzle() {
            const message = encodeURIComponent(
                `Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÛŒÚ©Ù…! ğŸ®\n\nÙ…ÛŒÚº Ù¾Ø²Ù„ Ú¯ÛŒÙ… Ú©Ú¾ÛŒÙ„Ù†Ø§ Ú†Ø§ÛØªØ§/Ú†Ø§ÛØªÛŒ ÛÙˆÚºÛ”\n\nğŸ’° ÙÛŒØ³: 50 Ø±ÙˆÙ¾Û’\nğŸ† Ø§Ù†Ø¹Ø§Ù…: 1000 Ø±ÙˆÙ¾Û’\nğŸ“² Easypaisa: 03359079528\n\nØ¨Ø±Ø§Û Ú©Ø±Ù… Ú©ÙˆÚˆ Ø¨Ú¾ÛŒØ¬ÛŒÚºÛ”`
            );
            
            const choice = confirm(`Ú©Ø³ Ù†Ù…Ø¨Ø± Ù¾Ø± Ø±Ø§Ø¨Ø·Û Ú©Ø±ÛŒÚºØŸ\n\nOK = ${WA_NUMBERS[0]}\nCancel = ${WA_NUMBERS[1]}`);
            const selectedNumber = choice ? WA_NUMBERS[0] : WA_NUMBERS[1];
            window.open(`https://wa.me/${selectedNumber}?text=${message}`, '_blank');
        }

        async function showPuzzleCodeInput() {
            const code = prompt("ğŸ”‘ Ø§Ù¾Ù†Ø§ Puzzle Game Ú©ÙˆÚˆ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº:");
            
            if (!code || code.trim() === "") {
                alert("âŒ Ú©ÙˆÚˆ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº!");
                return;
            }

            const enteredCode = code.trim().toUpperCase();

            try {
                const response = await fetch(`${SCRIPT_URL}?action=verifyCode&code=${encodeURIComponent(enteredCode)}`);
                const result = await response.text();

                if (result === "SUCCESS") {
                    usedCode = enteredCode;
                    userFullName = prompt("Ø§Ù¾Ù†Ø§ Ù…Ú©Ù…Ù„ Ù†Ø§Ù… Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº:");
                    
                    if (!userFullName || userFullName.trim() === "") {
                        alert("Ù†Ø§Ù… Ø¯Ø±Ø¬ Ú©Ø±Ù†Ø§ Ø¶Ø±ÙˆØ±ÛŒ ÛÛ’!");
                        return;
                    }

                    userFullName = userFullName.trim();
                    document.getElementById('puzzle-info').style.display = 'none';
                    document.getElementById('puzzle-game').style.display = 'block';
                    await getPuzzlesFromServer();
                } else {
                    alert("âŒ ÛŒÛ Ú©ÙˆÚˆ ØºÙ„Ø· ÛÛ’ ÛŒØ§ Ù¾ÛÙ„Û’ ÛÛŒ Ø§Ø³ØªØ¹Ù…Ø§Ù„ ÛÙˆ Ú†Ú©Ø§ ÛÛ’!");
                }
            } catch (error) {
                alert("âš ï¸ Ú©Ù†Ú©Ø´Ù† Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û ÛÛ’! Ø¯ÙˆØ¨Ø§Ø±Û Ú©ÙˆØ´Ø´ Ú©Ø±ÛŒÚºÛ”");
            }
        }

        async function getPuzzlesFromServer() {
            try {
                const response = await fetch(`${SCRIPT_URL}?action=getPuzzles`);
                puzzles = await response.json();
                
                if (!puzzles || puzzles.length === 0) {
                    alert("Ø³ÙˆØ§Ù„Ø§Øª Ù„ÙˆÚˆ Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©Û’!");
                    return;
                }
                
                displayQuestion();
            } catch (error) {
                alert("Ø³ÙˆØ§Ù„Ø§Øª Ù„ÙˆÚˆ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û ÛÛ’!");
            }
        }

        function displayQuestion() {
            if (currentIndex >= 5) {
                finishGame();
                return;
            }

            if (clock) clearInterval(clock);

            secondsLeft = 60;
            const timerElement = document.getElementById('timer');
            timerElement.innerText = secondsLeft;
            timerElement.classList.remove('warning');

            const puzzle = puzzles[currentIndex];
            document.getElementById('q-number').innerText = `Ø³ÙˆØ§Ù„ ${currentIndex + 1} / 5`;
            document.getElementById('q-content').innerText = puzzle.q;

            let optionsHtml = "";
            puzzle.opts.forEach((opt, index) => {
                const safeOpt = opt.replace(/'/g, "\\'");
                optionsHtml += `<button class="btn-opt" onclick="checkAnswer('${safeOpt}')">
                    ${String.fromCharCode(65 + index)}. ${opt}
                </button>`;
            });
            document.getElementById('options-box').innerHTML = optionsHtml;

            clock = setInterval(() => {
                secondsLeft--;
                timerElement.innerText = secondsLeft;

                if (secondsLeft <= 10) {
                    timerElement.classList.add('warning');
                }

                if (secondsLeft <= 0) {
                    clearInterval(clock);
                    alert("â° ÙˆÙ‚Øª Ø®ØªÙ…! Ø§Ú¯Ù„Û’ Ø³ÙˆØ§Ù„ Ù¾Ø± Ø¬Ø§ Ø±ÛÛ’ ÛÛŒÚºÛ”");
                    currentIndex++;
                    displayQuestion();
                }
            }, 1000);
        }

        function checkAnswer(selected) {
            const correctAnswer = puzzles[currentIndex].ans;
            
            if (selected === correctAnswer) {
                clearInterval(clock);
                currentIndex++;
                
                if (currentIndex < 5) {
                    setTimeout(() => displayQuestion(), 500);
                } else {
                    displayQuestion();
                }
            } else {
                clearInterval(clock);
                alert("âŒ ØºÙ„Ø· Ø¬ÙˆØ§Ø¨! Ø¢Ù¾ Ú¯ÛŒÙ… Ø³Û’ Ø¨Ø§ÛØ± ÛÙˆ Ú¯Ø¦Û’ ÛÛŒÚºÛ”\n\nÙ†ÛŒØ§ Ú©ÙˆÚˆ Ø­Ø§ØµÙ„ Ú©Ø± Ú©Û’ Ø¯ÙˆØ¨Ø§Ø±Û Ú©ÙˆØ´Ø´ Ú©Ø±ÛŒÚºÛ”");
                location.reload();
            }
        }

        async function finishGame() {
            clearInterval(clock);
            
            document.getElementById('puzzle-game').style.display = 'none';
            document.getElementById('puzzle-success').style.display = 'block';
            document.getElementById('tracking-id').innerText = 'â³ Ù…Ø­ÙÙˆØ¸ ÛÙˆ Ø±ÛØ§ ÛÛ’...';

            try {
                const response = await fetch(
                    `${SCRIPT_URL}?action=saveWinner&name=${encodeURIComponent(userFullName)}&code=${encodeURIComponent(usedCode)}`
                );
                const trackingId = await response.text();
                document.getElementById('tracking-id').innerText = trackingId;
            } catch (error) {
                document.getElementById('tracking-id').innerText = `ERROR_${Date.now()}`;
                alert("ÚˆÛŒÙ¹Ø§ Ù…Ø­ÙÙˆØ¸ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û ÛÛ’! Ø§Ø³Ú©Ø±ÛŒÙ† Ø´Ø§Ù¹ Ù„ÛŒÚº Ø§ÙˆØ± ÛÙ… Ø³Û’ Ø±Ø§Ø¨Ø·Û Ú©Ø±ÛŒÚºÛ”");
            }
        }

        function showNovelList() {
            currentScreen = "novelList";
            document.getElementById('novel-list-screen').style.display = 'block';
            const container = document.getElementById('novels-container');
            container.innerHTML = Object.keys(NOVELS).map(name => `
                <div class="novel-list-card" onclick="openNovel('${name}')">
                    <h3>ğŸ“– ${name}</h3>
                    <p>ØªÙ…Ø§Ù… Ø§Ù‚Ø³Ø§Ø· Ø¯Ø³ØªÛŒØ§Ø¨ ÛÛŒÚº</p>
                </div>
            `).join('');
        }

        function openNovel(novelName) {
            currentScreen = "episodes";
            currentNovel = novelName;
            document.getElementById('novel-list-screen').style.display = 'none';
            document.getElementById('content-screen').style.display = 'block';
            document.getElementById('section-title').innerText = `ğŸ“š ${novelName}`;
            renderNovel(NOVELS[novelName]);
        }

        function renderNovel(folderId) {
            const list = document.getElementById('items-list');
            let html = '';
            for (let i = 1; i <= 100; i++) {
                let pkg = getPkg(i);
                const isOpen = i <= 10 || unlocked.includes(pkg.id);
                html += `
                    <div class="card ${isOpen ? '' : 'locked'}" onclick="${isOpen ? `fetchAndOpen(${i}, '${folderId}')