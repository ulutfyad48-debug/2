<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø§ÙˆÙ„Ø³ØªØ§Ù† - Ù¾Ø²Ù„ Ú¯ÛŒÙ… Ú†ÛŒÙ„Ù†Ø¬</title>
    <style>
        :root {
            --primary: #ff4757;
            --secondary: #2f3542;
            --accent: #2ed573;
            --dark: #0f0f13;
            --card-bg: #1c1c24;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--dark);
            color: white;
            direction: rtl;
            text-align: center;
            min-height: 100vh;
            padding: 20px;
        }

        .navbar {
            background: var(--secondary);
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .navbar h1 {
            font-size: 32px;
            color: var(--primary);
            text-shadow: 0 0 10px rgba(255, 71, 87, 0.3);
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.7);
            border: 1px solid #333;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            background: var(--accent);
            color: #000;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .timer-circle {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            border: 5px solid var(--primary);
            line-height: 90px;
            font-size: 32px;
            font-weight: bold;
            margin: 0 auto 20px;
            color: var(--primary);
            box-shadow: 0 0 20px rgba(255, 71, 87, 0.4);
            animation: timerPulse 1s infinite;
        }

        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .timer-circle.warning {
            border-color: #ff9800;
            color: #ff9800;
            animation: timerWarning 0.5s infinite;
        }

        @keyframes timerWarning {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .q-header {
            color: #00d2ff;
            font-size: 16px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .q-text {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 25px;
            line-height: 1.6;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border-right: 4px solid var(--primary);
        }

        input {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #444;
            background: var(--dark);
            color: white;
            font-size: 18px;
            margin-bottom: 20px;
            text-align: center;
            transition: all 0.3s;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(255, 71, 87, 0.3);
        }

        .btn {
            width: 100%;
            padding: 15px;
            margin: 8px 0;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 71, 87, 0.3);
        }

        .btn-primary:hover {
            background: #ff3344;
            transform: translateY(-2px);
        }

        .btn-opt {
            background: #2d2d3a;
            color: white;
            border: 2px solid #444;
        }

        .btn-opt:hover {
            background: var(--primary);
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .btn-success {
            background: var(--accent);
            color: #000;
            box-shadow: 0 5px 15px rgba(46, 213, 115, 0.3);
        }

        #game-section,
        #success-section {
            display: none;
        }

        .winner-card {
            background: linear-gradient(135deg, var(--accent) 0%, #26de81 100%);
            color: #000;
            padding: 25px;
            border-radius: 15px;
            font-weight: bold;
            margin-bottom: 25px;
        }

        .tracking-display {
            background: #333;
            padding: 20px;
            border-radius: 12px;
            letter-spacing: 3px;
            color: var(--accent);
            font-size: 28px;
            font-weight: bold;
            margin: 20px 0;
            border: 2px dashed var(--accent);
            word-break: break-all;
        }

        .info-text {
            font-size: 14px;
            color: #aaa;
            line-height: 1.6;
            margin: 15px 0;
        }

        .error-message {
            background: rgba(255, 71, 87, 0.2);
            border: 2px solid var(--primary);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            color: var(--primary);
        }
    </style>
</head>
<body>

<div class="navbar">
    <h1>ğŸ® Ù†Ø§ÙˆÙ„Ø³ØªØ§Ù† - Ù¾Ø²Ù„ Ú†ÛŒÙ„Ù†Ø¬</h1>
</div>

<div class="container">
    <div id="auth-section">
        <div class="status-badge">âœ¨ Ø±ÙˆØ²Ø§Ù†Û Ù†ÛŒØ§ Ù¾Ø²Ù„</div>
        <h2 style="color: var(--primary); margin-bottom: 15px;">Ù¾Ø²Ù„ Ø§Ù†Ù¹Ø±ÛŒ Ú©ÙˆÚˆ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº</h2>
        <p class="info-text">Ú©ÙˆÚˆ Ø§ÛŒÚ© Ø¨Ø§Ø± Ø§Ø³ØªØ¹Ù…Ø§Ù„ ÛÙˆÙ†Û’ Ú©Û’ Ø¨Ø¹Ø¯ Ø®ØªÙ… ÛÙˆ Ø¬Ø§Ø¦Û’ Ú¯Ø§</p>
        <input type="text" id="accessCode" placeholder="Ø§Ù¾Ù†Ø§ Ú©ÙˆÚˆ ÛŒÛØ§Úº Ù„Ú©Ú¾ÛŒÚº..." maxlength="20">
        <button class="btn btn-primary" onclick="verifyCode()">ğŸ¯ Ú¯ÛŒÙ… Ø´Ø±ÙˆØ¹ Ú©Ø±ÛŒÚº</button>
        <p class="info-text" style="margin-top: 20px;">
            â±ï¸ ÛØ± Ø³ÙˆØ§Ù„ Ú©Û’ Ù„ÛŒÛ’ 60 Ø³ÛŒÚ©Ù†Úˆ<br>
            âŒ ØºÙ„Ø· Ø¬ÙˆØ§Ø¨ Ù¾Ø± Ú¯ÛŒÙ… Ø®ØªÙ…<br>
            ğŸ† 5 ØµØ­ÛŒØ­ Ø¬ÙˆØ§Ø¨Ø§Øª = 1000 Ø±ÙˆÙ¾Û’
        </p>
    </div>

    <div id="game-section">
        <div class="timer-circle" id="timer">60</div>
        <div class="q-header" id="q-number">Ø³ÙˆØ§Ù„ 1 / 5</div>
        <div class="q-text" id="q-content">Ù„ÙˆÚˆÙ†Ú¯...</div>
        <div id="options-box"></div>
    </div>

    <div id="success-section">
        <div class="winner-card">
            <h2>ğŸ‰ Ù…Ø¨Ø§Ø±Ú© ÛÙˆ!</h2>
            <p style="font-size: 18px; margin-top: 10px;">Ø¢Ù¾ Ù†Û’ ØªÙ…Ø§Ù… Ù¾Ø²Ù„ Ø­Ù„ Ú©Ø± Ù„ÛŒÛ’ ÛÛŒÚº</p>
        </div>
        <p style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">Ø¢Ù¾ Ú©ÛŒ Ù¹Ø±ÛŒÚ©Ù†Ú¯ Ø¢Ø¦ÛŒ ÚˆÛŒ:</p>
        <div class="tracking-display" id="tracking-id">LOADING...</div>
        <p class="info-text">
            ğŸ“¸ Ø§Ø³ Ø¢Ø¦ÛŒ ÚˆÛŒ Ú©Ø§ Ø§Ø³Ú©Ø±ÛŒÙ† Ø´Ø§Ù¹ Ù„ÛŒÚº<br>
            ğŸ“² Easypaisa: <strong>03359079528</strong><br>
            ğŸ“± ÙˆØ§Ù¹Ø³ Ø§ÛŒÙ¾ Ù¾Ø± Ø¨Ú¾ÛŒØ¬ÛŒÚº: <strong>03159226260</strong>
        </p>
        <button class="btn btn-success" onclick="location.reload()">ğŸ  Ù†ÛŒØ§ Ú¯ÛŒÙ… Ø´Ø±ÙˆØ¹ Ú©Ø±ÛŒÚº</button>
    </div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwk4hNSimgU__x1PHwrjJZe_596-2Ay-y6uTHamx7zYlSZP1MGg_dQXNtw73_f2VIKh/exec";
    
    let puzzles = [];
    let currentIndex = 0;
    let clock = null;
    let secondsLeft = 60;
    let userFullName = "";
    let usedCode = "";

    window.onbeforeunload = function(e) {
        if (currentIndex > 0 && currentIndex < 5) {
            e.preventDefault();
            return "Ú¯ÛŒÙ… Ø¬Ø§Ø±ÛŒ ÛÛ’! Ø±ÛŒÙØ±ÛŒØ´ Ú©Ø±Ù†Û’ Ø³Û’ Ø¢Ù¾ Ú©Ø§ Ú©ÙˆÚˆ Ø¶Ø§Ø¦Ø¹ ÛÙˆ Ø¬Ø§Ø¦Û’ Ú¯Ø§Û”";
        }
    };

    async function verifyCode() {
        const code = document.getElementById('accessCode').value.trim();
        
        if (!code) {
            showError("Ø¨Ø±Ø§Û Ú©Ø±Ù… Ú©ÙˆÚˆ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº!");
            return;
        }

        const btn = event.target;
        btn.disabled = true;
        btn.innerHTML = 'â³ Ú†ÛŒÚ© ÛÙˆ Ø±ÛØ§ ÛÛ’...';

        try {
            const response = await fetch(`${SCRIPT_URL}?action=verifyCode&code=${encodeURIComponent(code)}`);
            const result = await response.text();

            if (result === "SUCCESS") {
                usedCode = code;
                userFullName = prompt("Ø§Ù¾Ù†Ø§ Ù…Ú©Ù…Ù„ Ù†Ø§Ù… Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº:");
                
                if (!userFullName || userFullName.trim() === "") {
                    alert("Ù†Ø§Ù… Ø¯Ø±Ø¬ Ú©Ø±Ù†Ø§ Ø¶Ø±ÙˆØ±ÛŒ ÛÛ’!");
                    location.reload();
                    return;
                }

                userFullName = userFullName.trim();
                document.getElementById('auth-section').style.display = 'none';
                document.getElementById('game-section').style.display = 'block';
                await getPuzzlesFromServer();
            } else {
                showError("ÛŒÛ Ú©ÙˆÚˆ ØºÙ„Ø· ÛÛ’ ÛŒØ§ Ù¾ÛÙ„Û’ ÛÛŒ Ø§Ø³ØªØ¹Ù…Ø§Ù„ ÛÙˆ Ú†Ú©Ø§ ÛÛ’!");
                btn.disabled = false;
                btn.innerHTML = 'ğŸ¯ Ú¯ÛŒÙ… Ø´Ø±ÙˆØ¹ Ú©Ø±ÛŒÚº';
            }
        } catch (error) {
            console.error('Error:', error);
            showError("Ú©Ù†Ú©Ø´Ù† Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û ÛÛ’! Ø¯ÙˆØ¨Ø§Ø±Û Ú©ÙˆØ´Ø´ Ú©Ø±ÛŒÚºÛ”");
            btn.disabled = false;
            btn.innerHTML = 'ğŸ¯ Ú¯ÛŒÙ… Ø´Ø±ÙˆØ¹ Ú©Ø±ÛŒÚº';
        }
    }

    async function getPuzzlesFromServer() {
        try {
            const response = await fetch(`${SCRIPT_URL}?action=getPuzzles`);
            puzzles = await response.json();
            
            if (!puzzles || puzzles.length === 0) {
                showError("Ø³ÙˆØ§Ù„Ø§Øª Ù„ÙˆÚˆ Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©Û’!");
                return;
            }
            
            displayQuestion();
        } catch (error) {
            console.error('Error:', error);
            showError("Ø³ÙˆØ§Ù„Ø§Øª Ù„ÙˆÚˆ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û ÛÛ’!");
        }
    }

    function displayQuestion() {
        if (currentIndex >= 5) {
            finishGame();
            return;
        }

        if (clock) clearInterval(clock);

        secondsLeft = 60;
        const timerElement = document.getElementById('timer');
        timerElement.innerText = secondsLeft;
        timerElement.classList.remove('warning');

        const puzzle = puzzles[currentIndex];
        document.getElementById('q-number').innerText = `Ø³ÙˆØ§Ù„ ${currentIndex + 1} / 5`;
        document.getElementById('q-content').innerText = puzzle.q;

        let optionsHtml = "";
        puzzle.opts.forEach((opt, index) => {
            const safeOpt = opt.replace(/'/g, "\\'");
            optionsHtml += `<button class="btn btn-opt" onclick="checkAnswer('${safeOpt}')">
                ${String.fromCharCode(65 + index)}. ${opt}
            </button>`;
        });
        document.getElementById('options-box').innerHTML = optionsHtml;

        clock = setInterval(() => {
            secondsLeft--;
            timerElement.innerText = secondsLeft;

            if (secondsLeft <= 10) {
                timerElement.classList.add('warning');
            }

            if (secondsLeft <= 0) {
                clearInterval(clock);
                alert("â° ÙˆÙ‚Øª Ø®ØªÙ…! Ø§Ú¯Ù„Û’ Ø³ÙˆØ§Ù„ Ù¾Ø± Ø¬Ø§ Ø±ÛÛ’ ÛÛŒÚºÛ”");
                currentIndex++;
                displayQuestion();
            }
        }, 1000);
    }

    function checkAnswer(selected) {
        const correctAnswer = puzzles[currentIndex].ans;
        
        if (selected === correctAnswer) {
            clearInterval(clock);
            currentIndex++;
            
            if (currentIndex < 5) {
                setTimeout(() => displayQuestion(), 500);
            } else {
                displayQuestion();
            }
        } else {
            clearInterval(clock);
            alert("âŒ ØºÙ„Ø· Ø¬ÙˆØ§Ø¨! Ø¢Ù¾ Ú¯ÛŒÙ… Ø³Û’ Ø¨Ø§ÛØ± ÛÙˆ Ú¯Ø¦Û’ ÛÛŒÚºÛ”\n\nÙ†ÛŒØ§ Ú©ÙˆÚˆ Ø­Ø§ØµÙ„ Ú©Ø± Ú©Û’ Ø¯ÙˆØ¨Ø§Ø±Û Ú©ÙˆØ´Ø´ Ú©Ø±ÛŒÚºÛ”");
            location.reload();
        }
    }

    async function finishGame() {
        clearInterval(clock);
        
        document.getElementById('game-section').innerHTML = `
            <div style="padding: 40px;">
                <div class="timer-circle" style="border-color: var(--accent); color: var(--accent);">â³</div>
                <h3 style="margin-top: 20px;">Ø¢Ù¾ Ú©Ø§ ÚˆÛŒÙ¹Ø§ Ù…Ø­ÙÙˆØ¸ ÛÙˆ Ø±ÛØ§ ÛÛ’...</h3>
                <p class="info-text">Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø§Ù†ØªØ¸Ø§Ø± Ú©Ø±ÛŒÚº</p>
            </div>
        `;

        try {
            const response = await fetch(
                `${SCRIPT_URL}?action=saveWinner&name=${encodeURIComponent(userFullName)}&code=${encodeURIComponent(usedCode)}`
            );
            const trackingId = await response.text();

            document.getElementById('game-section').style.display = 'none';
            document.getElementById('tracking-id').innerText = trackingId;
            document.getElementById('success-section').style.display = 'block';
            
            window.onbeforeunload = null;
        } catch (error) {
            console.error('Error:', error);
            document.getElementById('game-section').innerHTML = `
                <div class="error-message">
                    <h3>ÚˆÛŒÙ¹Ø§ Ù…Ø­ÙÙˆØ¸ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û ÛÛ’!</h3>
                    <p>Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø§Ù¾Ù†Ø§ Ø§Ø³Ú©Ø±ÛŒÙ† Ø´Ø§Ù¹ Ù„ÛŒÚº Ø§ÙˆØ± ÛÙ… Ø³Û’ Ø±Ø§Ø¨Ø·Û Ú©Ø±ÛŒÚºÛ”</p>
                    <p><strong>Ù†Ø§Ù…:</strong> ${userFullName}</p>
                    <p><strong>Ú©ÙˆÚˆ:</strong> ${usedCode}</p>
                </div>
            `;
        }
    }

    function showError(message) {
        const authSection = document.getElementById('auth-section');
        let errorDiv = document.querySelector('.error-message');
        
        if (!errorDiv) {
            errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            authSection.insertBefore(errorDiv, authSection.firstChild);
        }
        
        errorDiv.textContent = message;
        
        setTimeout(() => {
            if (errorDiv && errorDiv.parentNode) {
                errorDiv.remove();
            }
        }, 5000);
    }
</script>

</body>
</html>